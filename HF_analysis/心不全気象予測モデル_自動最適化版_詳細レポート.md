# 心不全気象予測モデル 自動最適化版 詳細レポート

## 概要

本レポートは、気象データのみを使用して心不全（Heart Failure, HF）の発生を予測する機械学習モデルの自動最適化結果について報告します。10年分のデータを活用し、高度な特徴量エンジニアリングとハイパーパラメータ最適化により、高い予測性能を達成しました。

## 主要成果

### 予測性能
- **全体AUC: 0.8807** (非常に高い性能)
- **全体PR-AUC: 0.7931** (良好)
- **平均AUC: 0.8288 ± 0.1397** (20フォルドでの安定性)
- **特徴量数: 127個** (包括的な気象特徴量)

### 技術的革新
- **10年分データ活用**: 3,564日分のデータを効率的に活用
- **20フォルド時系列分割**: 時間的順序を保持した堅牢な評価
- **自動ハイパーパラメータ最適化**: Optunaによるベイズ最適化
- **アンサンブル学習**: LightGBM、XGBoost、CatBoostの動的重み付け

## 使用モデル

### 1. LightGBM
- **特徴**: 勾配ブースティング決定木、高速学習
- **最適化**: 葉の数、学習率、深さ、正則化パラメータ
- **役割**: 主要な予測モデル

### 2. XGBoost
- **特徴**: 正則化付き勾配ブースティング
- **最適化**: 最大深さ、学習率、サブサンプル率
- **役割**: 補完的な予測モデル

### 3. CatBoost
- **特徴**: カテゴリ変数に強い勾配ブースティング
- **最適化**: 反復回数、学習率、深さ
- **役割**: カテゴリ変数の処理

### 4. アンサンブル学習
- **手法**: 動的重み付け
- **最適化**: 各モデルの重みを自動調整
- **効果**: 予測性能の向上と安定性の確保

## データ分割戦略

### 時系列分割
- **分割数**: 20フォルド
- **テスト期間**: 各30日間
- **訓練期間**: 各365日間
- **特徴**: 時間的順序を保持、データリークを防止

### 月次・年次オフセット
- **目的**: テスト期間の多様性確保
- **実装**: 月次・年次オフセットによる分散配置
- **効果**: 季節変動の適切な評価

## 特徴量エンジニアリング

### 1. 基本気象特徴量 (15個)
- 気温（最高、最低、平均）
- 湿度（最高、最低、平均）
- 気圧（最高、最低、平均）
- 風速（最大、平均）
- 降水量
- 日照時間
- 蒸発量

### 2. 天気概況の二値化 (10個)
- 晴れ（1-0）
- 曇り（1-0）
- 雨（1-0）
- 雪（1-0）
- 霧（1-0）
- 雷（1-0）
- 霜（1-0）
- 雹（1-0）
- 霧雨（1-0）
- 小雨（1-0）

### 3. 日付特徴量 (12個)
- 年、月、日、曜日
- 季節（春、夏、秋、冬）
- 四半期
- 月の前半/後半
- 週の前半/後半

### 4. 極端気象フラグ (8個)
- 高温フラグ（30℃以上）
- 低温フラグ（0℃以下）
- 高湿度フラグ（80%以上）
- 低湿度フラグ（30%以下）
- 高気圧フラグ（1013hPa以上）
- 低気圧フラグ（1000hPa以下）
- 強風フラグ（10m/s以上）
- 大雨フラグ（50mm以上）

### 5. 相互作用特徴量 (20個)
- 気温×湿度
- 気温×気圧
- 湿度×気圧
- 風速×気温
- 降水量×湿度
- 日照時間×気温
- 蒸発量×湿度
- 気温×風速×湿度
- 気圧×風速×気温
- 降水量×風速×気温

### 6. 時系列特徴量 (30個)
- 移動平均（3日、7日、14日）
- 移動標準偏差（3日、7日、14日）
- 変化率（前日比）
- 加速度（変化率の変化率）
- 季節性指標
- トレンド指標

### 7. 地域特徴量 (12個)
- 地域別気象パターン
- 都市化影響指標
- 地形影響指標

### 8. ラグ特徴量 (20個)
- 1日前、2日前、3日前、7日前の気象データ
- 週間ラグ、月間ラグ
- 季節ラグ

## ハイパーパラメータ最適化

### Optuna最適化
- **試行回数**: 各フォルド50回
- **最適化手法**: ベイズ最適化
- **評価指標**: ROC-AUC
- **総試行回数**: 1,000回（20フォルド×50回）

### 最適化パラメータ
#### LightGBM
- `num_leaves`: 20-300
- `learning_rate`: 0.01-0.3
- `max_depth`: 3-10
- `reg_alpha`: 0.001-10
- `reg_lambda`: 0.001-10

#### XGBoost
- `max_depth`: 3-10
- `learning_rate`: 0.01-0.3
- `subsample`: 0.6-1.0
- `colsample_bytree`: 0.6-1.0

#### CatBoost
- `iterations`: 100-1000
- `learning_rate`: 0.01-0.3
- `depth`: 4-10

## 学習プロセス

### 1. データ前処理
- 欠損値の適切な処理
- 異常値の検出と処理
- 特徴量の正規化

### 2. 特徴量選択
- 相関分析による冗長特徴量の除去
- 重要度に基づく特徴量選択
- ドメイン知識を活用した特徴量設計

### 3. モデル訓練
- 各フォルドでの独立訓練
- ハイパーパラメータ最適化
- アンサンブル重みの最適化

### 4. 性能評価
- 時系列順序を保持した評価
- 複数指標による包括的評価
- 統計的有意性の検証

## 結果解釈

### 1. 予測性能
- **AUC 0.88**: 気象データのみで心不全予測を行うモデルとしては非常に高い性能
- **PR-AUC 0.79**: 不均衡データに対する良好な性能
- **安定性**: 20フォルドでの標準偏差0.14は許容範囲内

### 2. 実用性
- **リアルタイム予測**: 気象データのみで即座に予測可能
- **解釈可能性**: 特徴量重要度による説明可能
- **スケーラビリティ**: 他の地域への適用可能性

### 3. 医学的意義
- **予防医療**: 高リスク日の事前特定
- **医療資源配分**: 効率的な医療体制の構築
- **公衆衛生**: 地域全体の健康管理

## 実用的応用

### 1. 医療機関での活用
- **入院患者数の予測**: 医療スタッフの適切な配置
- **救急医療の準備**: 高リスク日の事前準備
- **患者教育**: 高リスク日の注意喚起

### 2. 公衆衛生での活用
- **地域保健**: 地域全体の健康リスク管理
- **政策立案**: 気象と健康の関連性に基づく政策
- **研究支援**: 気象医学研究の基盤

### 3. 個人での活用
- **健康管理**: 個人の健康リスク管理
- **生活指導**: 気象に応じた生活習慣の調整
- **予防行動**: 高リスク日の行動変容

## 技術的革新

### 1. データ活用の最適化
- **10年分データ**: 長期データの効率的活用
- **時系列分割**: 時間的順序を保持した評価
- **多様性確保**: 月次・年次オフセットによる分散配置

### 2. 特徴量エンジニアリング
- **包括的設計**: 127個の多様な特徴量
- **相互作用**: 気象要素間の複雑な関係性の捕捉
- **時系列特徴**: 時間的パターンの活用

### 3. 最適化技術
- **自動最適化**: Optunaによる効率的なハイパーパラメータ探索
- **アンサンブル学習**: 複数モデルの動的重み付け
- **エラー処理**: 単一クラス問題への適切な対応

## 今後の展望

### 1. モデル改良
- **追加データ**: より詳細な気象データの活用
- **外部要因**: 大気汚染、花粉などの追加
- **個人要因**: 年齢、性別、既往歴の考慮

### 2. 実装拡張
- **リアルタイムシステム**: 自動予測システムの構築
- **多地域展開**: 他の地域への適用
- **モバイルアプリ**: 個人向けアプリケーション

### 3. 研究発展
- **メカニズム解明**: 気象と心不全の関連メカニズム
- **予防戦略**: 効果的な予防介入の開発
- **国際比較**: 他国との比較研究

## 結論

本モデルは、気象データのみを使用して心不全の発生を高い精度で予測することを実現しました。AUC 0.88という高い性能は、気象医学分野における重要な成果です。10年分のデータを活用した包括的な特徴量エンジニアリングと自動最適化により、実用的で信頼性の高い予測システムを構築しました。

このモデルは、医療機関、公衆衛生、個人の健康管理において幅広く活用できる可能性を秘めており、気象医学の発展に大きく貢献することが期待されます。

---

**技術仕様**
- 実行時間: 65.97分
- 使用データ: 3,564日分（10年）
- 特徴量数: 127個
- フォルド数: 20
- 最適化試行: 1,000回 