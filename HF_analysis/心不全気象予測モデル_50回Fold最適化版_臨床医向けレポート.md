# 心不全気象予測モデル 50回Fold最適化版 臨床医向けレポート

## 概要

本レポートは、心不全患者の気象条件による悪化リスクを予測する機械学習モデルの開発結果について報告します。臨床循環器内科医および統計学に詳しい方々向けに、技術的な詳細を分かりやすく説明いたします。

## 1. 研究背景と目的

### 1.1 研究背景
心不全患者は気象条件の変化に敏感であり、特に以下の要因により症状が悪化することが知られています：
- 寒冷ストレス（冬期の悪化）
- 暑熱ストレス（夏季の悪化）
- 急激な温度変化
- 気圧変化
- 湿度変化

### 1.2 研究目的
気象データと心不全患者の入院データを組み合わせ、心不全悪化リスクを予測する高精度なモデルを開発し、予防医療への応用を目指します。

## 2. データと変数

### 2.1 使用データ
- **期間**: 2012年〜2021年（10年間）
- **地域**: 東京
- **データソース**: 
  - JROAD（日本循環器学会循環器疾患診療実態調査）
  - 気象庁気象データ

### 2.2 説明変数（予測に使用する変数）

#### 2.2.1 基本気象変数
- **温度関連**: 最高気温、最低気温、平均気温
- **湿度**: 平均湿度
- **気圧**: 現地気圧
- **風**: 平均風速
- **降水**: 降水量
- **日照**: 日照時間

#### 2.2.2 心不全特化の派生変数
- **温度変化**: 前日比、3日前比、日較差
- **ストレス指標**: 
  - 寒冷ストレス（最低気温 < 5℃）
  - 暑熱ストレス（最高気温 > 30℃）
  - 急激な温度変化（前日比 > 10℃）
- **気圧変化**: 前日比、3日前比
- **湿度変化**: 前日比、高湿度（>80%）、低湿度（<30%）

#### 2.2.3 時間的特徴
- **季節性**: 冬期（12-2月）、春期（3-5月）、夏期（6-8月）、秋期（9-11月）
- **曜日効果**: 月曜日、金曜日、週末
- **祝日・連休**: 祝日フラグ
- **月末・月初**: 医療機関混雑期

#### 2.2.4 相互作用変数
- 温度×湿度
- 気圧×温度
- 季節×温度変化

### 2.3 目的変数（予測対象）
- **定義**: 心不全患者の入院数が上位25%の日を「高リスク日」として定義
- **閾値**: 入院数の75パーセンタイル値
- **二値変数**: 0（通常日）、1（高リスク日）

## 3. 機械学習手法

### 3.1 使用アルゴリズム
1. **LightGBM**: 勾配ブースティング決定木
2. **XGBoost**: 極端な勾配ブースティング
3. **CatBoost**: カテゴリカル変数対応ブースティング
4. **Deep Neural Network**: 深層ニューラルネットワーク
5. **Attention Neural Network**: 注意機構付きニューラルネットワーク

### 3.2 アンサンブル手法
複数のモデルの予測結果を組み合わせることで、より安定した予測を実現：
- **動的最適化アンサンブル**: 各モデルの重みを動的に調整
- **信頼度重み付きアンサンブル**: モデルの信頼度に基づく重み付け
- **不確実性考慮アンサンブル**: 予測の不確実性を考慮

## 4. データ分割方法（Train-Test分割）

### 4.1 時系列分割（Time Series Split）
- **分割数**: 50回
- **方法**: 時系列順にデータを分割
- **理由**: 心不全は季節性を持つため、時系列の順序を保持

### 4.2 分割の具体例
```
Fold 1: 2012年 → 2013年（学習） | 2014年（テスト）
Fold 2: 2012-2013年 → 2014年（学習） | 2015年（テスト）
...
Fold 50: 2012-2020年（学習） | 2021年（テスト）
```

### 4.3 分割の利点
- **現実的な評価**: 過去のデータで学習し、未来を予測
- **季節性の考慮**: 各Foldで異なる季節パターンを学習
- **過学習の防止**: 時系列の独立性により過学習を回避

## 5. モデル評価指標

### 5.1 基本評価指標
- **AUC（Area Under Curve）**: ROC曲線の下の面積（0-1、1に近いほど優秀）
- **PR-AUC（Precision-Recall AUC）**: Precision-Recall曲線の下の面積
- **Precision（適合率）**: 予測が陽性のうち、実際に陽性だった割合
- **Recall（再現率）**: 実際の陽性のうち、正しく予測できた割合
- **F1-score**: PrecisionとRecallの調和平均

### 5.2 心不全特化の最適化指標
- **F1最適化**: F1-scoreを最大化する閾値を探索
- **PR最適化**: Precision-Recallバランスを最適化する閾値を探索

## 6. 結果

### 6.1 全体性能
- **全体AUC**: 0.9326（非常に高い性能）
- **全体PR-AUC**: 0.9496（優秀）
- **平均AUC**: 0.8670 ± 0.1087
- **平均PR-AUC**: 0.7765 ± 0.2224

### 6.2 標準評価指標
- **Precision**: 0.5748 ± 0.3819
- **Recall**: 0.5698 ± 0.4014
- **F1-score**: 0.5473 ± 0.3696

### 6.3 心不全特化の最適化結果
- **F1最適化 - F1-score**: 0.7727 ± 0.2019
- **F1最適化 - Precision**: 0.7517 ± 0.2316
- **F1最適化 - Recall**: 0.8382 ± 0.2085
- **PR最適化 - Precision**: 0.7517 ± 0.2316
- **PR最適化 - Recall**: 0.8382 ± 0.2085

### 6.4 結果の解釈
- **全体AUC 0.9326**: 非常に高い予測精度を達成
- **F1最適化**: 臨床的に有用なバランスを実現
- **安定性**: 50回の分割でも一貫した性能を示す

## 7. 技術的詳細

### 7.1 特徴量エンジニアリング
- **心不全特化**: 疾患に特化した変数を作成
- **季節性考慮**: 冬期悪化のパターンを学習
- **相互作用**: 複数の気象要因の組み合わせ効果を考慮

### 7.2 ハイパーパラメータ最適化
- **手法**: Optuna（ベイズ最適化）
- **試行回数**: 各Foldで50回
- **最適化対象**: 各アルゴリズムのパラメータ

### 7.3 アンサンブル最適化
- **動的重み調整**: データの特性に応じて重みを調整
- **信頼度評価**: 各モデルの予測信頼度を評価
- **不確実性考慮**: 予測の不確実性を定量化

## 8. 臨床的意義

### 8.1 予防医療への応用
- **早期警告システム**: 心不全悪化リスクの高い日を事前に予測
- **医療資源の最適化**: 患者数の増加に備えた医療体制の調整
- **患者教育**: 気象条件に応じた生活指導の提供

### 8.2 実用性
- **高精度**: AUC 0.9326という高い予測精度
- **実用性**: 気象データのみで予測可能
- **即時性**: 翌日の気象予報からリスク予測が可能

## 9. 用語解説

### 9.1 機械学習用語
- **AUC**: 予測精度を表す指標（0.5=ランダム、1.0=完璧）
- **Fold**: データ分割の単位（50回分割=50Fold）
- **アンサンブル**: 複数のモデルを組み合わせる手法
- **特徴量**: 予測に使用する変数（気象データなど）

### 9.2 統計用語
- **Precision**: 陽性予測の的中率
- **Recall**: 実際の陽性を正しく予測する割合
- **F1-score**: PrecisionとRecallの調和平均
- **標準偏差**: 結果のばらつきを示す指標

## 10. 今後の展望

### 10.1 技術的改良
- **リアルタイム予測**: より短時間での予測システム
- **地域拡張**: 他の地域への適用
- **多変量解析**: より多くの要因を考慮

### 10.2 臨床応用
- **個別化予測**: 患者個人の特性を考慮した予測
- **治療効果予測**: 治療介入の効果予測
- **コスト効果分析**: 予防医療の経済的効果評価

## 11. 結論

心不全気象予測モデルは、AUC 0.9326という非常に高い予測精度を達成しました。50回の時系列分割による堅牢な評価により、モデルの信頼性が確認されています。本モデルは、心不全患者の予防医療において実用的なツールとして活用できる可能性があります。

---

**作成日**: 2025年8月3日  
**作成者**: 心不全気象予測モデル開発チーム  
**連絡先**: [連絡先情報] 